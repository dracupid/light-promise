(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};(function(root,factory){if(typeof module==="object"&&typeof module.exports==="object"){return module.exports=factory(root)}else if(typeof define==="function"&&define.amd){return define("light-promise",[],function(){return factory(root)})}else{root.light_promise=factory(root);if(!root.Promise){return root.Promise=factory(root)}}})(this,function(root){var Promise,resolveX;Promise=function(){function Promise(resolver){this.reject=__bind(this.reject,this);this.resolve=__bind(this.resolve,this);var err;this.state="pending";try{resolver&&resolver.call(null,this.resolve,this.reject)}catch(_error){err=_error;this.reject(err)}this}Promise.prototype.then=function(onFulfilled,onRejected){this.onFulfilled=onFulfilled;this.onRejected=onRejected;this._next=new Promise;switch(this.state){case"fulfilled":this._fireResolve();break;case"rejected":this._fireReject()}return this._next};Promise.prototype["catch"]=function(onRejected){return this["then"](null,onRejected)};Promise.prototype.resolve=function(value){this.value=value;this.state="fulfilled";this._fireResolve();return this};Promise.prototype.reject=function(reason){this.reason=reason;this.state="rejected";this._fireReject();return this};Promise.prototype._fireResolve=function(){var e,rs,_ref,_ref1;try{if(this.onFulfilled){rs=this.onFulfilled.call(null,this.value);if(this._next){return resolveX(this._next,rs)}}else{return(_ref=this._next)!=null?_ref.resolve(this.value):void 0}}catch(_error){e=_error;return(_ref1=this._next)!=null?_ref1.reject(e):void 0}};Promise.prototype._fireReject=function(){var e,rs,_ref,_ref1;try{if(this.onRejected){rs=this.onRejected.call(null,this.reason);if(this._next){return resolveX(this._next,rs)}}else{return(_ref=this._next)!=null?_ref.reject(this.reason):void 0}}catch(_error){e=_error;return(_ref1=this._next)!=null?_ref1.reject(e):void 0}};return Promise}();resolveX=function(promise,x){if(x instanceof Promise){switch(x.state){case"pending":x.then(promise.resolve,promise.reject);break;case"fulfilled":promise.resolve(x.value);break;case"rejected":promise.reject(x.reason)}}else{promise.resolve(x)}return promise};Promise.resolve=function(value){var p;p=new Promise;p.resolve(value);return p};Promise.reject=function(reason){var p;p=new Promise;p.reject(reason);return p};Promise.all=function(promises){var done,finish,i,p,promise,result,_i,_len;promise=new Promise;result=new Array(promise.length);finish=0;done=false;for(i=_i=0,_len=promises.length;_i<_len;i=++_i){p=promises[i];p.then(function(rs){result[i]=rs;if(++finish===promises.length&&!done){return promise.resolve(result)}},function(err){done=true;return promise.reject(err)})}return promise};return Promise})}).call(this);